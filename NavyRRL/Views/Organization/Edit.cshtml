@using Models.Schema;
@using Newtonsoft.Json;
@model Organization
@{
	var title = Model.Id > 0 ? "Editing Organization" : "New Organization";
	ViewBag.Title = title;
}

@Html.Partial( "~/Views/Shared/_FormHelperV1.cshtml" )

<script type="text/javascript">
	var Data = {
		//The original resource
		Source: @Html.Raw( JsonConvert.SerializeObject( Model ) ),
		//Mapping used internally for the FormItem stuff
		Form: {},
		//Functions to configure FormItem stuff
		Config: {
			//On Save...
			SaveButton: function (Field) {
				Field.handleClick = function () {
					//Create a new object from the combination of the existing object and the updates
					var data = {
						...Data.Source,
						...Data.Form.read()
					};
					//Then save it and get the object back from the server, and use its ID to redirect to its detail page (or do other things?)
					console.log("Saving Data", data);
					FormItem.doPOSTRequest("@Url.Content("~/organization/save/")", data, function(response) {
						FormItem.handleSave(response, "@Url.Content("~/organization/detail/")" + (response.Data?.Id || 0));
					});
				}
			}
		}
	};

	$(document).ready(function () {
		FormItem.setupFormItems(Data.Form, "Organization", Data.Config);
		Data.Form.write(Data.Source);
	});
	//
</script>

<h2>@title</h2>

<form-item data-path="Organization.Id" data-ui="display" data-label="ID"></form-item>
<form-item data-path="Organization.RowId" data-ui="display" data-label="RowID"></form-item>
<form-item data-path="Organization.Name" data-ui="text" data-label="Name"></form-item>
<form-item data-path="Organization.AlternateName" data-ui="text" data-label="Abbreviation"></form-item>
<form-item data-path="Organization.Description" data-ui="textarea" data-label="Description"></form-item>
<form-item data-path="Organization.SaveButton" data-ui="button" data-label="Save Changes" data-config="SaveButton"></form-item>